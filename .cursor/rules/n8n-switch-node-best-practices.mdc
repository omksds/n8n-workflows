---
globs: *.json
description: n8n Switch ãƒãƒ¼ãƒ‰ã®è¨­å®šã¨ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
---

# n8n Switch ãƒãƒ¼ãƒ‰ ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

## ğŸ¯ é‡è¦ãªæ•™è¨“: ãƒ–ãƒ¼ãƒ«å€¤æ¯”è¼ƒã‚’ä½¿ç”¨ã™ã‚‹

### âŒ å•é¡Œã®ã‚ã£ãŸãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆæ•°å€¤æ¯”è¼ƒï¼‰

```json
{
  "conditions": [
    {
      "leftValue": "={{ $json.image_analysis.aspectRatio }}",
      "rightValue": 0.67,
      "operator": {
        "type": "number",
        "operation": "smaller"
      }
    }
  ]
}
```

**å•é¡Œ**: Python ã® `float` ã¨ n8n ã®æ•°å€¤å‹ã§å‹ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿ

### âœ… æ­£è§£ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆãƒ–ãƒ¼ãƒ«å€¤æ¯”è¼ƒï¼‰

```json
{
  "conditions": [
    {
      "leftValue": "={{ $json.image_analysis.is_tall }}",
      "rightValue": "",
      "operator": {
        "type": "boolean",
        "operation": "true",
        "singleValue": true
      }
    }
  ]
}
```

**åˆ©ç‚¹**: å‹ã®å•é¡Œã‚’å®Œå…¨ã«å›é¿ã€ã‚ˆã‚Šå®‰å®šã—ãŸå‹•ä½œ

## ğŸ”§ Switch ãƒãƒ¼ãƒ‰å¿…é ˆè¨­å®š

### åŸºæœ¬è¨­å®š

```json
{
  "parameters": {
    "rules": {
      "values": [
        {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "loose", // é‡è¦: "strict" ã§ã¯ãªã "loose"
              "version": 2
            }
          }
        }
      ]
    },
    "looseTypeValidation": true, // é‡è¦: å‹å¤‰æ›ã‚’è¨±å¯
    "options": {}
  }
}
```

### ãƒ–ãƒ¼ãƒ«å€¤æ¯”è¼ƒã®è¨­å®š

```json
{
  "operator": {
    "type": "boolean",
    "operation": "true", // ã¾ãŸã¯ "false"
    "singleValue": true // é‡è¦: ãƒ–ãƒ¼ãƒ«å€¤æ¯”è¼ƒæ™‚ã¯å¿…é ˆ
  }
}
```

## ğŸ“‹ æ¡ä»¶åˆ†å²ãƒ‘ã‚¿ãƒ¼ãƒ³

### äºŒåˆ†å²ï¼ˆç¸¦é•· vs ç¸¦é•·ã§ãªã„ï¼‰

```json
{
  "rules": {
    "values": [
      {
        "conditions": {
          "conditions": [
            {
              "leftValue": "={{ $json.image_analysis.is_tall }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "false",
                "singleValue": true
              }
            }
          ]
        },
        "renameOutput": true,
        "outputKey": "not_tall_images"
      },
      {
        "conditions": {
          "conditions": [
            {
              "leftValue": "={{ $json.image_analysis.is_tall }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ]
        },
        "renameOutput": true,
        "outputKey": "tall_images"
      }
    ]
  }
}
```

### å¤šåˆ†å²ï¼ˆç¸¦é•·ãƒ»æ­£æ–¹å½¢ãƒ»æ¨ªé•·ï¼‰

```json
{
  "rules": {
    "values": [
      {
        "conditions": {
          "conditions": [
            {
              "leftValue": "={{ $json.image_analysis.is_tall }}",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ]
        },
        "outputKey": "tall_images"
      },
      {
        "conditions": {
          "conditions": [
            {
              "leftValue": "={{ $json.image_analysis.is_square }}",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ]
        },
        "outputKey": "square_images"
      },
      {
        "conditions": {
          "conditions": [
            {
              "leftValue": "={{ $json.image_analysis.is_wide }}",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ]
        },
        "outputKey": "wide_images"
      }
    ]
  }
}
```

## ğŸ Code ãƒãƒ¼ãƒ‰ã§ã®äº‹å‰æº–å‚™

### Switch ãƒãƒ¼ãƒ‰ç”¨ãƒ–ãƒ¼ãƒ«å€¤ã®æº–å‚™

```python
# ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”ã‹ã‚‰å„ç¨®ãƒ–ãƒ¼ãƒ«å€¤ã‚’è¨ˆç®—
aspect_ratio = width / height

image_data = {
    # å…ƒã®æ•°å€¤ãƒ‡ãƒ¼ã‚¿
    'aspectRatio': float(aspect_ratio),
    'decimal_ratio': round(aspect_ratio, 3),

    # Switch ãƒãƒ¼ãƒ‰ç”¨ãƒ–ãƒ¼ãƒ«å€¤ï¼ˆæ¨å¥¨ï¼‰
    'is_tall': bool(aspect_ratio < 0.67),      # 2:3ã‚ˆã‚Šç¸¦é•·
    'is_square': bool(0.8 <= aspect_ratio < 1.2),  # æ­£æ–¹å½¢ã«è¿‘ã„
    'is_wide': bool(aspect_ratio >= 1.2),          # æ¨ªé•·

    # è¤‡åˆæ¡ä»¶ã‚‚å¯èƒ½
    'is_portrait': bool(aspect_ratio < 0.8),       # ãƒãƒ¼ãƒˆãƒ¬ãƒ¼ãƒˆ
    'is_landscape': bool(aspect_ratio > 1.25),     # ãƒ©ãƒ³ãƒ‰ã‚¹ã‚±ãƒ¼ãƒ—

    # æ–‡å­—åˆ—åˆ†é¡ï¼ˆå‚è€ƒç”¨ï¼‰
    'classification': 'tall' if aspect_ratio < 0.67 else 'not_tall'
}
```

## ğŸš¨ ã‚ˆãã‚ã‚‹å•é¡Œã¨è§£æ±ºç­–

### 1. å‹ã‚¨ãƒ©ãƒ¼å•é¡Œ

**å•é¡Œ**: `TypeError: Cannot read properties of undefined (reading 'singleValue')`
**è§£æ±º**: `"singleValue": true` ã‚’è¿½åŠ 

### 2. æ•°å€¤æ¯”è¼ƒã®å‹ä¸æ•´åˆ

**å•é¡Œ**: Python ã® `float` ãŒ Switch ã§èªè­˜ã•ã‚Œãªã„
**è§£æ±º**: ãƒ–ãƒ¼ãƒ«å€¤æ¯”è¼ƒã«å¤‰æ›´

### 3. å³å¯†ãªå‹ãƒã‚§ãƒƒã‚¯

**å•é¡Œ**: `"typeValidation": "strict"` ã§ã‚¨ãƒ©ãƒ¼
**è§£æ±º**: `"typeValidation": "loose"` ã«å¤‰æ›´

### 4. å‹å¤‰æ›ã‚¨ãƒ©ãƒ¼

**å•é¡Œ**: `looseTypeValidation: false` ã§å‹å¤‰æ›å¤±æ•—
**è§£æ±º**: `looseTypeValidation: true` ã«è¨­å®š

## ğŸ” ãƒ‡ãƒãƒƒã‚°ã¨ãƒ†ã‚¹ãƒˆ

### Switch ãƒãƒ¼ãƒ‰ã®ãƒ†ã‚¹ãƒˆæ–¹æ³•

```python
# Code ãƒãƒ¼ãƒ‰ã§ã®ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°
print(f"[SWITCH_DEBUG] is_tall: {is_tall} (type: {type(is_tall)})")
print(f"[SWITCH_DEBUG] is_square: {is_square} (type: {type(is_square)})")
print(f"[SWITCH_DEBUG] is_wide: {is_wide} (type: {type(is_wide)})")

# Switch å¾Œã®ãƒãƒ¼ãƒ‰ã§ã®ç¢ºèª
print(f"[SWITCH_RESULT] Received via: {_json.get('switch_path', 'unknown')}")
```

### æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œç¢ºèª

1. **å…¥åŠ›ãƒ‡ãƒ¼ã‚¿**: `aspectRatio: 1.333`
2. **ãƒ–ãƒ¼ãƒ«å€¤è¨ˆç®—**: `is_tall: false`, `is_wide: true`
3. **Switch åˆ†å²**: `wide_images` å‡ºåŠ›çµŒè·¯
4. **å¾Œç¶šãƒãƒ¼ãƒ‰**: é©åˆ‡ãªãƒ‡ãƒ¼ã‚¿ã‚’å—ä¿¡

## ğŸ“Š è¨­å®šæ¯”è¼ƒè¡¨

| è¨­å®šé …ç›®              | æ¨å¥¨å€¤    | éæ¨å¥¨å€¤     | ç†ç”±               |
| --------------------- | --------- | ------------ | ------------------ |
| `typeValidation`      | `"loose"` | `"strict"`   | å‹ãƒã‚§ãƒƒã‚¯ã‚’ç·©å’Œ   |
| `looseTypeValidation` | `true`    | `false`      | å‹å¤‰æ›ã‚’è¨±å¯       |
| `singleValue`         | `true`    | `false`      | ãƒ–ãƒ¼ãƒ«å€¤æ¯”è¼ƒæ™‚å¿…é ˆ |
| æ¯”è¼ƒæ–¹æ³•              | ãƒ–ãƒ¼ãƒ«å€¤  | æ•°å€¤ç›´æ¥æ¯”è¼ƒ | å‹å®‰å…¨æ€§           |

## ğŸ¯ ã¾ã¨ã‚

1. **ãƒ–ãƒ¼ãƒ«å€¤æ¯”è¼ƒã‚’ä½¿ç”¨** - æ•°å€¤æ¯”è¼ƒã¯é¿ã‘ã‚‹
2. **äº‹å‰ã«ãƒ–ãƒ¼ãƒ«å€¤ã‚’è¨ˆç®—** - Code ãƒãƒ¼ãƒ‰ã§æº–å‚™
3. **é©åˆ‡ãªè¨­å®š** - `looseTypeValidation: true`, `typeValidation: "loose"`
4. **ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°** - å„æ®µéšã§ã®å€¤ã¨å‹ã‚’ç¢ºèª
