---
alwaysApply: true
---

# n8n ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚¬ã‚¤ãƒ‰

ã“ã®ãƒãƒ£ãƒƒãƒˆã§ç™ºç”Ÿã—ãŸå•é¡Œã¨è§£æ±ºç­–ã‚’è¨˜éŒ²ã—ã€åŒæ§˜ã®å•é¡Œã‚’é˜²ããŸã‚ã®ã‚¬ã‚¤ãƒ‰ã€‚

## ğŸš¨ ç™ºç”Ÿã—ãŸä¸»è¦ãªå•é¡Œ

### 1. Switch ãƒãƒ¼ãƒ‰ã§ã®å‹ã‚¨ãƒ©ãƒ¼

**ç—‡çŠ¶**: `TypeError: Cannot read properties of undefined (reading 'singleValue')`
**åŸå› **: Switch ãƒãƒ¼ãƒ‰ã®è¨­å®šä¸å‚™
**è§£æ±º**: `"singleValue": true` ã‚’è¿½åŠ ã€ãƒ–ãƒ¼ãƒ«å€¤æ¯”è¼ƒã«å¤‰æ›´

### 2. Python Code ãƒãƒ¼ãƒ‰ã§ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã‚¨ãƒ©ãƒ¼

**ç—‡çŠ¶**: `'>' not supported between instances of 'str' and 'int'`
**åŸå› **: n8n S3 ãƒãƒ¼ãƒ‰ãŒ `'1.06 MB'` å½¢å¼ã®æ–‡å­—åˆ—ã‚’è¿”ã™
**è§£æ±º**: `parse_file_size()` é–¢æ•°ã§æ•°å€¤å¤‰æ›

### 3. ãƒã‚¤ãƒŠãƒªãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹ã‚¨ãƒ©ãƒ¼

**ç—‡çŠ¶**: `Property 'image_data' does not exist on type 'Record<{}, N8nBinary>'`
**åŸå› **: Code ãƒãƒ¼ãƒ‰ã®ãƒ¢ãƒ¼ãƒ‰è¨­å®šã¨ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹æ–¹æ³•ã®ä¸æ•´åˆ
**è§£æ±º**: `runOnceForEachItem` ãƒ¢ãƒ¼ãƒ‰ã§ `$binary.image_data` ã‚’ä½¿ç”¨

### 4. Switch ãƒãƒ¼ãƒ‰ã§ã®æ•°å€¤æ¯”è¼ƒå•é¡Œ

**ç—‡çŠ¶**: Python ã® `float` ãŒ Switch ãƒãƒ¼ãƒ‰ã§èªè­˜ã•ã‚Œãªã„
**åŸå› **: å‹ã®ä¸æ•´åˆ
**è§£æ±º**: æ•°å€¤æ¯”è¼ƒã§ã¯ãªããƒ–ãƒ¼ãƒ«å€¤æ¯”è¼ƒã‚’ä½¿ç”¨

## ğŸ› ï¸ å•é¡Œè§£æ±ºã®ãƒ‘ã‚¿ãƒ¼ãƒ³

### ãƒ‘ã‚¿ãƒ¼ãƒ³ 1: å‹ã‚¨ãƒ©ãƒ¼ã®è§£æ±º

```python
# âŒ å•é¡Œã®ã‚ã‚‹ã‚³ãƒ¼ãƒ‰
file_size = binary_data.get('fileSize', 0)  # '1.06 MB' ãŒè¿”ã•ã‚Œã‚‹
if file_size > 1000000:  # TypeError

# âœ… è§£æ±ºã‚³ãƒ¼ãƒ‰
raw_file_size = binary_data.get('fileSize', 0)
file_size_bytes = parse_file_size(raw_file_size)  # æ•°å€¤ã«å¤‰æ›
if file_size_bytes > 1000000:  # OK
```

### ãƒ‘ã‚¿ãƒ¼ãƒ³ 2: Switch ãƒãƒ¼ãƒ‰è¨­å®šã®ä¿®æ­£

```json
// âŒ å•é¡Œã®ã‚ã‚‹è¨­å®š
{
  "leftValue": "={{ $json.image_analysis.aspectRatio }}",
  "rightValue": 0.67,
  "operator": {"type": "number", "operation": "smaller"}
}

// âœ… è§£æ±ºè¨­å®š
{
  "leftValue": "={{ $json.image_analysis.is_tall }}",
  "rightValue": "",
  "operator": {"type": "boolean", "operation": "true", "singleValue": true}
}
```

### ãƒ‘ã‚¿ãƒ¼ãƒ³ 3: Code ãƒãƒ¼ãƒ‰ã§ã®ãƒ‡ãƒ¼ã‚¿æº–å‚™

```python
# Switch ãƒãƒ¼ãƒ‰ç”¨ã«ãƒ–ãƒ¼ãƒ«å€¤ã‚’äº‹å‰è¨ˆç®—
image_data = {
    'aspectRatio': float(aspect_ratio),
    'is_tall': bool(aspect_ratio < 0.67),  # Switchç”¨
    'classification': str(classification)
}
```

## ğŸ” ãƒ‡ãƒãƒƒã‚°æ‰‹é †

### 1. ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã®ç¢ºèª

- ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°ã‚’ç¢ºèª
- n8n ã®å®Ÿè¡Œãƒ­ã‚°ã‚’ç¢ºèª
- Python Code ãƒãƒ¼ãƒ‰ã® `print()` å‡ºåŠ›ã‚’ç¢ºèª

### 2. ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼ã®è¿½è·¡

```python
# å„æ®µéšã§ã®ãƒ‡ãƒ¼ã‚¿ç¢ºèª
print(f"[DEBUG] Input: {_json}")
print(f"[DEBUG] Binary keys: {list(_binary.keys()) if _binary else []}")
print(f"[DEBUG] Calculated: aspectRatio={aspect_ratio}, is_tall={is_tall}")
print(f"[DEBUG] Output: {image_data}")
```

### 3. å‹ã®ç¢ºèª

```python
# å‹æƒ…å ±ã®å‡ºåŠ›
print(f"[TYPE_DEBUG] aspectRatio: {type(aspect_ratio)}")
print(f"[TYPE_DEBUG] is_tall: {type(is_tall)}")
print(f"[TYPE_DEBUG] classification: {type(classification)}")
```

## ğŸ“‹ ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### Code ãƒãƒ¼ãƒ‰ä½œæˆæ™‚

- [ ] `mode: "runOnceForEachItem"` ã‚’è¨­å®š
- [ ] æ˜ç¤ºçš„ãªå‹å¤‰æ›ã‚’å®Ÿè£…
- [ ] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’è¿½åŠ 
- [ ] ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°ã‚’è¿½åŠ 
- [ ] ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’è¨­å®š

### Switch ãƒãƒ¼ãƒ‰ä½œæˆæ™‚

- [ ] `looseTypeValidation: true` ã‚’è¨­å®š
- [ ] `typeValidation: "loose"` ã‚’è¨­å®š
- [ ] ãƒ–ãƒ¼ãƒ«å€¤æ¯”è¼ƒã‚’ä½¿ç”¨
- [ ] `singleValue: true` ã‚’è¨­å®šï¼ˆãƒ–ãƒ¼ãƒ«å€¤æ™‚ï¼‰
- [ ] é©åˆ‡ãª `outputKey` ã‚’è¨­å®š

### S3 çµ±åˆæ™‚

- [ ] `binaryPropertyName: "image_data"` ã‚’è¨­å®š
- [ ] ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºãƒ‘ãƒ¼ã‚¹é–¢æ•°ã‚’å®Ÿè£…
- [ ] ãƒã‚¤ãƒŠãƒªãƒ‡ãƒ¼ã‚¿ã®å­˜åœ¨ç¢ºèªã‚’è¿½åŠ 
- [ ] AWS èªè¨¼æƒ…å ±ã‚’è¨­å®š

### å…¨ä½“çš„ãªç¢ºèª

- [ ] ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®æ¥ç¶šã‚’ç¢ºèª
- [ ] ã‚¨ãƒ©ãƒ¼æ™‚ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†
- [ ] ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã®ä½œæˆ
- [ ] ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®æ›´æ–°

## ğŸ¯ äºˆé˜²ç­–

### 1. å‹å®‰å…¨æ€§ã®ç¢ºä¿

- å…¨ã¦ã®å€¤ã‚’æ˜ç¤ºçš„ã«å‹å¤‰æ›
- Switch ãƒãƒ¼ãƒ‰ã§ã¯ãƒ–ãƒ¼ãƒ«å€¤æ¯”è¼ƒã‚’å„ªå…ˆ
- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’å¿…ãšè¨­å®š

### 2. è¨­å®šã®æ¨™æº–åŒ–

- Switch ãƒãƒ¼ãƒ‰ã¯å¸¸ã« `looseTypeValidation: true`
- Code ãƒãƒ¼ãƒ‰ã¯ `runOnceForEachItem` ãƒ¢ãƒ¼ãƒ‰
- ä¸€è²«ã—ãŸãƒãƒ¼ãƒŸãƒ³ã‚°è¦å‰‡

### 3. ãƒ†ã‚¹ãƒˆã®å®Ÿæ–½

- å„æ®µéšã§ã®ãƒ‡ãƒ¼ã‚¿ç¢ºèª
- ã‚¨ãƒ©ãƒ¼ã‚±ãƒ¼ã‚¹ã®ãƒ†ã‚¹ãƒˆ
- å‹å¤‰æ›ã®å‹•ä½œç¢ºèª

### 4. ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆåŒ–

- è¨­å®šã®ç†ç”±ã‚’è¨˜éŒ²
- ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°æ‰‹é †ã‚’æ–‡æ›¸åŒ–
- ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã®å…±æœ‰

## ğŸ“š å‚è€ƒãƒ•ã‚¡ã‚¤ãƒ«

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ä½œæˆã•ã‚ŒãŸå‚è€ƒãƒ•ã‚¡ã‚¤ãƒ«ï¼š

- [My workflow 3.json](mdc:dev/image_aspect_ratio_workflow/My workflow 3.json) - æ­£è§£ã¨ãªã£ãŸãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼
- [PYTHON-FILESIZE-FIX.md](mdc:dev/image_aspect_ratio_workflow/PYTHON-FILESIZE-FIX.md) - ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã‚¨ãƒ©ãƒ¼ã®ä¿®æ­£
- [SWITCH-COMPATIBILITY-FIX.md](mdc:dev/image_aspect_ratio_workflow/SWITCH-COMPATIBILITY-FIX.md) - Switch æ•´åˆæ€§å•é¡Œã®ä¿®æ­£
